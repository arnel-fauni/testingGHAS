name: Security Alerts to Slack
on:
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours
  workflow_dispatch:
permissions:
  security-events: read
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        id: alerts
        with:
          script: |
            const alerts = await github.rest.codeScanning.listAlertsForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open'
            });
            if (alerts.data.length > 0) {
              const alert = alerts.data[0];
              core.setOutput('alert', `ðŸš¨ ${alert.most_recent_instance.rule.severity}: ${alert.most_recent_instance.message.text.slice(0,100)}`);
              core.setOutput('url', alert.html_url);
            }
      - run: |
          curl -X POST -H 'Content-type: application/json' \
          --data "{\"text\":\"${{ steps.alerts.outputs.alert }} | <${{ steps.alerts.outputs.url }}|View>\"}' \
          YOUR_SLACK_WEBHOOK_URL
        if: steps.alerts.outputs.alert != ''
