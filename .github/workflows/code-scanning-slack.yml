name: Code Scanning Debug
on:
  schedule:
    - cron: '*/15 * * * *'
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: DEBUG - Show ALL Data
        env:
          GH_TOKEN: ${{ github.token }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          echo "üîç DEBUGGING..."
          
          # 1. RAW API response
          RAW=$(gh api /repos/${{ github.repository }}/code-scanning/alerts?state=open 2>/dev/null || echo "NO_ALERTS")
          echo "RAW API: $RAW" | head -c 500
          
          # 2. Count alerts
          COUNT=$(echo "$RAW" | jq '.alerts | length // 0')
          echo "ALERT COUNT: $COUNT"
          
          # 3. ALWAYS send to Slack (debug info)
          curl -X POST -H 'Content-type: application/json' \
            --data "{
              \"text\": \"üîç *DEBUG: ${{ github.repository }}*\n
              *Raw API length:* $(echo $RAW | wc -c)\n
              *Alert count:* $COUNT\n
              *First 200 chars:* $(echo \"$RAW\" | head -c 200)\"
            }" "$SLACK_WEBHOOK_URL"
