- name: Trigger Slack Workflow
  if: steps.alerts.outputs.alert_count != '0'
  uses: slackapi/slack-github-action@v1.26.0
  env:
    SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WORKFLOW_WEBHOOK_URL }}
  with:
    webhook-type: webhook-trigger
    payload: |
      {
        "repo": "${{ github.repository }}",
        "alert_count": ${{ steps.alerts.outputs.alert_count }},
        "alert1_severity": "${{ fromJson(steps.alerts.outputs.alerts_json)[0].severity || 'none' }}",
        "alert1_message": "${{ fromJson(steps.alerts.outputs.alerts_json)[0].message || 'No message' }}",
        "alert1_url": "${{ fromJson(steps.alerts.outputs.alerts_json)[0].url || '' }}",
        "alert2_severity": "${{ fromJson(steps.alerts.outputs.alerts_json)[1].severity || '' }}",
        "alert2_message": "${{ fromJson(steps.alerts.outputs.alerts_json)[1].message || '' }}",
        "alert2_url": "${{ fromJson(steps.alerts.outputs.alerts_json)[1].url || '' }}"
      }
