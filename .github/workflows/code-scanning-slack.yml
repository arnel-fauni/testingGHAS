- name: Process alerts (minimal)
  id: flatten
  uses: actions/github-script@v7
  with:
    script: |
      const alerts = JSON.parse('${{ steps.alerts.outputs.alerts_json }}');
      
      core.setOutput('repo', process.env.GITHUB_REPOSITORY);
      core.setOutput('alert1_severity', alerts[0]?.most_recent_instance?.rule?.severity || 'none');

- name: Trigger Slack Workflow
  if: steps.flatten.outputs.alert1_severity != 'none'
  uses: slackapi/slack-github-action@v1.26.0
  env:
    SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WORKFLOW_WEBHOOK_URL }}
  with:
    webhook-type: webhook-trigger
    payload: |
      {
        "repo": "${{ steps.flatten.outputs.repo }}",
        "alert1_severity": "${{ steps.flatten.outputs.alert1_severity }}"
      }
